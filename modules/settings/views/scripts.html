<script type="module">
  import { apiFetch } from '/public/js/utils.js';

  // Einstellungen laden
  async function loadSettings() {
    try {
      const settings = await apiFetch('/api/settings');
      
      document.getElementById('siteName').value = settings.siteName;
      document.getElementById('theme').value = settings.theme;
      document.getElementById('language').value = settings.language;
      document.getElementById('notifications').checked = settings.notifications;

      // Theme anwenden wenn geladen
      applyTheme(settings.theme);
    } catch (error) {
      alert('Fehler beim Laden der Einstellungen: ' + error.message);
    }
  }

  // Theme anwenden
  function applyTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
  }

  // Einstellungen speichern
  document.getElementById('settingsForm').onsubmit = async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const settings = {
      siteName: formData.get('siteName'),
      theme: formData.get('theme'),
      language: formData.get('language'),
      notifications: formData.get('notifications') === 'on'
    };

    try {
      const response = await apiFetch('/api/settings', {
        method: 'POST',
        data: settings
      });

      const successMessage = document.getElementById('successMessage');
      successMessage.style.display = 'block';
      setTimeout(() => {
        successMessage.style.display = 'none';
      }, 3000);

      // Theme sofort anwenden
      applyTheme(settings.theme);
    } catch (error) {
      alert('Fehler beim Speichern der Einstellungen: ' + error.message);
    }
  };

  // Initial load
  loadSettings();
</script>